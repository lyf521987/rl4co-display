# å®æ—¶è®­ç»ƒæ›²çº¿åŠŸèƒ½ - ä¿®æ”¹æ€»ç»“

## ğŸ“‹ éœ€æ±‚æè¿°

åœ¨TSPé—®é¢˜è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®æ—¶å±•ç¤ºæ¯ä¸ªepochçš„Losså’ŒRewardå˜åŒ–æ›²çº¿ï¼Œæ¯è®­ç»ƒå®Œæˆä¸€ä¸ªepochå°±åœ¨æŠ˜çº¿å›¾ä¸Šæ ‡æ³¨ç›¸åº”çš„æŒ‡æ ‡å€¼ã€‚

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. åç«¯ä¿®æ”¹ (app.py)

#### ä¿®æ”¹ä½ç½®ï¼š`ProgressCallback` ç±»

**æ–°å¢å±æ€§**ï¼ˆç¬¬1196-1199è¡Œï¼‰ï¼š
```python
# ç”¨äºå­˜å‚¨æ‰€æœ‰epochçš„å†å²æ•°æ®ï¼Œç”¨äºç»˜åˆ¶æŠ˜çº¿å›¾
self.history_losses = []  # æ‰€æœ‰epochçš„å¹³å‡losså†å²
self.history_rewards = []  # æ‰€æœ‰epochçš„å¹³å‡rewardå†å²
self.history_epochs = []  # epochç¼–å·åˆ—è¡¨
```

**æ–°å¢åŠŸèƒ½**ï¼ˆç¬¬1293-1343è¡Œï¼‰ï¼šåœ¨ `on_train_epoch_end` æ–¹æ³•ä¸­æ·»åŠ ï¼š
1. è®°å½•å†å²æ•°æ®
2. ç”Ÿæˆè®­ç»ƒæ›²çº¿å›¾ï¼ˆåŒå­å›¾ï¼šLoss + Rewardï¼‰
3. é€šè¿‡SSEæ¨é€å›¾è¡¨URL

**å…³é”®ä»£ç **ï¼š
```python
# è®°å½•å†å²æ•°æ®
self.history_epochs.append(epoch)
self.history_losses.append(loss)
self.history_rewards.append(reward)

# ç”ŸæˆåŒ…å«Losså’ŒRewardçš„åŒå­å›¾
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8))

# ç»˜åˆ¶Lossæ›²çº¿ï¼ˆè“è‰²ï¼‰
ax1.plot(self.history_epochs, self.history_losses, 'b-o', linewidth=2, markersize=6)

# ç»˜åˆ¶Rewardæ›²çº¿ï¼ˆç»¿è‰²ï¼‰
ax2.plot(self.history_epochs, self.history_rewards, 'g-o', linewidth=2, markersize=6)

# æ ‡æ³¨æœ€ä½³Rewardï¼ˆçº¢è‰²è™šçº¿+æ˜Ÿæ ‡ï¼‰
ax2.axhline(y=self.best_reward, color='r', linestyle='--', alpha=0.5)
ax2.scatter([best_epoch_num], [self.best_reward], color='red', s=100, marker='*')

# ä¿å­˜å¹¶æ¨é€
plt.savefig(plot_path, dpi=150, bbox_inches="tight")
self.queue.put(json.dumps({
    'type': 'plot',
    'plot_url': f"/static/model_plots/{plot_filename}",
    'message': f'Epoch {epoch} è®­ç»ƒæ›²çº¿å·²æ›´æ–°'
}))
```

**æ›´æ–°è®­ç»ƒçŠ¶æ€**ï¼ˆç¬¬1352è¡Œï¼‰ï¼š
```python
'plot_url': f"/static/model_plots/training_curves_{self.session_id[:8]}.png"
```

**æ›´æ–°å®Œæˆç»“æœ**ï¼ˆç¬¬1566è¡Œï¼‰ï¼š
```python
'training_curve': training_status[session_id].get('plot_url', '')
```

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### å®æ—¶æ€§
- âœ… æ¯ä¸ªepochå®Œæˆåç«‹å³ç”Ÿæˆæ›´æ–°çš„æ›²çº¿å›¾
- âœ… é€šè¿‡SSEå®æ—¶æ¨é€åˆ°å‰ç«¯
- âœ… ä¸éœ€è¦ç­‰å¾…è®­ç»ƒå®Œæˆ

### å¯è§†åŒ–æ•ˆæœ
- âœ… **Lossæ›²çº¿**ï¼šè“è‰²æŠ˜çº¿ + åœ†å½¢æ ‡è®°
- âœ… **Rewardæ›²çº¿**ï¼šç»¿è‰²æŠ˜çº¿ + åœ†å½¢æ ‡è®°  
- âœ… **æœ€ä½³Rewardæ ‡æ³¨**ï¼šçº¢è‰²è™šçº¿ + æ˜Ÿå½¢æ ‡è®°
- âœ… ç½‘æ ¼èƒŒæ™¯ï¼Œä¾¿äºè¯»æ•°
- âœ… ä¸­æ–‡æ ‡é¢˜å’Œæ ‡ç­¾

### å›¾è¡¨ä¿¡æ¯
- ğŸ“ˆ æ¨ªè½´ï¼šEpochç¼–å·ï¼ˆ1, 2, 3...ï¼‰
- ğŸ“‰ çºµè½´ï¼šLoss/Rewardæ•°å€¼
- ğŸ† æœ€ä½³å€¼ç”¨æ˜Ÿæ ‡çªå‡ºæ˜¾ç¤º
- ğŸ“Š åŒå­å›¾å¸ƒå±€ï¼ˆä¸ŠLossï¼Œä¸‹Rewardï¼‰

## ğŸ”„ æ¶ˆæ¯ç±»å‹

### æ–°å¢ï¼šplot æ¶ˆæ¯
æ¯ä¸ªepochç»“æŸæ—¶å‘é€ï¼š
```json
{
    "type": "plot",
    "plot_url": "/static/model_plots/training_curves_12345678.png",
    "message": "Epoch 5 è®­ç»ƒæ›²çº¿å·²æ›´æ–°"
}
```

### æ›´æ–°ï¼šprogress æ¶ˆæ¯
ä¿æŒä¸å˜ï¼Œç»§ç»­å‘é€epochè¿›åº¦ä¿¡æ¯

### æ›´æ–°ï¼šcomplete æ¶ˆæ¯
åœ¨ç»“æœä¸­æ–°å¢ `training_curve` å­—æ®µï¼š
```json
{
    "type": "complete",
    "message": "è®­ç»ƒå®Œæˆï¼",
    "results": {
        ...
        "training_curve": "/static/model_plots/training_curves_12345678.png"
    }
}
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### ç”Ÿæˆçš„æ–‡ä»¶
```
static/model_plots/
â”œâ”€â”€ training_curves_<session_idå‰8ä½>.png  â† è®­ç»ƒæ›²çº¿å›¾
â”œâ”€â”€ comparison_<session_idå‰8ä½>_1.png     â† è·¯å¾„å¯¹æ¯”å›¾
â”œâ”€â”€ animation_<session_idå‰8ä½>_1.gif      â† è·¯å¾„åŠ¨ç”»
â””â”€â”€ ...
```

### å‘½åè§„åˆ™
- Session ID: `a1b2c3d4-e5f6-7890-abcd-1234567890ef`
- æ›²çº¿å›¾æ–‡ä»¶å: `training_curves_a1b2c3d4.png`

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
python app.py
```

### 2. è®¿é—®è®­ç»ƒé¡µé¢
```
http://localhost:5000/home
```

### 3. é…ç½®è®­ç»ƒå‚æ•°
- **æ¨¡å‹**: Attention Model
- **é—®é¢˜**: TSP
- **Epochs**: 5-10ï¼ˆå»ºè®®ç”¨å°‘é‡epochå¿«é€Ÿæµ‹è¯•ï¼‰
- **Batch Size**: 512
- **Learning Rate**: 0.0001

### 4. è§‚å¯Ÿæ•ˆæœ
å¯åŠ¨è®­ç»ƒåï¼Œåº”è¯¥çœ‹åˆ°ï¼š
1. âœ… ç¬¬1ä¸ªepochå®Œæˆåï¼Œå‡ºç°åˆå§‹æ›²çº¿å›¾ï¼ˆåªæœ‰1ä¸ªç‚¹ï¼‰
2. âœ… ç¬¬2ä¸ªepochå®Œæˆåï¼Œæ›²çº¿å›¾æ›´æ–°ï¼ˆ2ä¸ªç‚¹è¿æˆçº¿ï¼‰
3. âœ… æ¯ä¸ªepochéƒ½ä¼šæ›´æ–°æ›²çº¿å›¾ï¼Œç‚¹è¶Šæ¥è¶Šå¤š
4. âœ… å‰ç«¯æ—¥å¿—æ˜¾ç¤º "Epoch X è®­ç»ƒæ›²çº¿å·²æ›´æ–°"
5. âœ… å›¾è¡¨ä¸­çº¢è‰²æ˜Ÿæ ‡æ ‡æ³¨æœ€ä½³Rewardçš„epoch

### 5. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
è®­ç»ƒè¿‡ç¨‹ä¸­æ£€æŸ¥ `static/model_plots/` ç›®å½•ï¼š
```bash
ls static/model_plots/training_curves_*.png
```
åº”è¯¥çœ‹åˆ°å¯¹åº”sessionçš„æ›²çº¿å›¾æ–‡ä»¶ã€‚

## ğŸ¯ å‰ç«¯é›†æˆ

### æ–¹æ³•1ï¼šä¿®æ”¹ç°æœ‰æ¨¡æ¿

åœ¨ `templates/index.html` ä¸­æ·»åŠ ï¼š

```html
<!-- è®­ç»ƒæ›²çº¿æ˜¾ç¤ºåŒºåŸŸ -->
<div id="trainingCurvesSection" style="display: none;">
    <h3>è®­ç»ƒæ›²çº¿ï¼ˆå®æ—¶æ›´æ–°ï¼‰</h3>
    <img id="trainingCurveImg" 
         src="" 
         alt="è®­ç»ƒæ›²çº¿" 
         style="width: 100%; max-width: 800px;">
    <p id="curveUpdateInfo"></p>
</div>
```

JavaScriptå¤„ç†ï¼š
```javascript
eventSource.addEventListener('message', function(event) {
    const data = JSON.parse(event.data);
    
    if (data.type === 'plot') {
        // æ˜¾ç¤ºæ›²çº¿åŒºåŸŸ
        document.getElementById('trainingCurvesSection').style.display = 'block';
        
        // æ›´æ–°å›¾ç‰‡ï¼ˆæ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜ï¼‰
        const img = document.getElementById('trainingCurveImg');
        img.src = data.plot_url + '?t=' + new Date().getTime();
        
        // æ›´æ–°æç¤ºä¿¡æ¯
        document.getElementById('curveUpdateInfo').textContent = data.message;
    }
});
```

### æ–¹æ³•2ï¼šä½¿ç”¨ç¤ºä¾‹é¡µé¢

ç›´æ¥ä½¿ç”¨æä¾›çš„ `å®æ—¶è®­ç»ƒæ›²çº¿å‰ç«¯ç¤ºä¾‹.html`ï¼š
1. å¤åˆ¶åˆ° `templates/` ç›®å½•
2. æ·»åŠ è·¯ç”±åˆ° `app.py`ï¼š
```python
@app.route('/training_demo')
def training_demo():
    return render_template('å®æ—¶è®­ç»ƒæ›²çº¿å‰ç«¯ç¤ºä¾‹.html')
```
3. è®¿é—® `http://localhost:5000/training_demo`

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥SSEæ¶ˆæ¯
æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network â†’ æ‰¾åˆ° `training_progress` è¯·æ±‚ï¼š
```
EventStream
type: plot
plot_url: /static/model_plots/training_curves_12345678.png
message: Epoch 3 è®­ç»ƒæ›²çº¿å·²æ›´æ–°
```

### æ£€æŸ¥ç”Ÿæˆçš„å›¾è¡¨
ç›´æ¥è®¿é—®URLæµ‹è¯•ï¼š
```
http://localhost:5000/static/model_plots/training_curves_12345678.png
```

### æŸ¥çœ‹Pythonæ—¥å¿—
å¦‚æœç»˜å›¾å¤±è´¥ï¼Œä¼šå‘é€ `warning` æ¶ˆæ¯ï¼š
```json
{
    "type": "warning",
    "message": "ç”Ÿæˆè®­ç»ƒæ›²çº¿å¤±è´¥: <é”™è¯¯ä¿¡æ¯>"
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘
- æ¯ä¸ªepochéƒ½ä¼šä¿å­˜ä¸€æ¬¡PNGå›¾ç‰‡ï¼ˆçº¦100-200KBï¼‰
- å¦‚æœè®­ç»ƒ100ä¸ªepochï¼Œä¼šé¢‘ç¹å†™å…¥ç£ç›˜
- å»ºè®®è®­ç»ƒå®Œæˆåå¯ä»¥æ¸…ç†æ—§çš„æ›²çº¿å›¾

### 2. æµè§ˆå™¨ç¼“å­˜
- URLå¿…é¡»åŠ æ—¶é—´æˆ³å‚æ•° `?t=timestamp`
- å¦åˆ™æµè§ˆå™¨ä¼šæ˜¾ç¤ºç¼“å­˜çš„æ—§å›¾ç‰‡

### 3. ä¸­æ–‡æ˜¾ç¤º
- å·²é…ç½®å­—ä½“ï¼šSimHei, Microsoft YaHei
- å¦‚æœä¸­æ–‡æ˜¾ç¤ºä¸ºæ–¹å—ï¼Œæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦å®‰è£…è¿™äº›å­—ä½“

### 4. å®¹é”™å¤„ç†
- ç»˜å›¾å¤±è´¥ä¸ä¼šä¸­æ–­è®­ç»ƒ
- åªä¼šå‘é€warningæ¶ˆæ¯
- è®­ç»ƒç»§ç»­æ­£å¸¸è¿›è¡Œ

## ğŸ“¦ ç›¸å…³æ–‡ä»¶

### å·²ä¿®æ”¹
- âœ… `app.py` - åç«¯æ ¸å¿ƒé€»è¾‘

### æ–°å¢
- âœ… `å®æ—¶è®­ç»ƒæ›²çº¿åŠŸèƒ½è¯´æ˜.md` - è¯¦ç»†åŠŸèƒ½æ–‡æ¡£
- âœ… `å®æ—¶è®­ç»ƒæ›²çº¿å‰ç«¯ç¤ºä¾‹.html` - å®Œæ•´å‰ç«¯ç¤ºä¾‹
- âœ… `å®æ—¶è®­ç»ƒæ›²çº¿-ä¿®æ”¹æ€»ç»“.md` - æœ¬æ–‡æ¡£

### éœ€è¦å‰ç«¯é…åˆä¿®æ”¹ï¼ˆå¯é€‰ï¼‰
- `templates/index.html` - æ·»åŠ æ›²çº¿æ˜¾ç¤ºåŒºåŸŸå’Œå¤„ç†é€»è¾‘

## ğŸš€ å¿«é€ŸéªŒè¯æ­¥éª¤

1. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   python app.py
   ```

2. **æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°**
   ```
   F12 â†’ Console
   ```

3. **å¼€å§‹ä¸€ä¸ªçŸ­è®­ç»ƒ**
   - Epochs: 3
   - å…¶ä»–å‚æ•°é»˜è®¤

4. **è§‚å¯Ÿç°è±¡**
   - [ ] Epoch 1å®Œæˆåï¼ŒSSEæ”¶åˆ°ç¬¬ä¸€æ¡ `type: plot` æ¶ˆæ¯
   - [ ] å›¾è¡¨æ˜¾ç¤º1ä¸ªè“ç‚¹ï¼ˆLossï¼‰å’Œ1ä¸ªç»¿ç‚¹ï¼ˆRewardï¼‰
   - [ ] Epoch 2å®Œæˆåï¼Œå›¾è¡¨æ›´æ–°ä¸º2ä¸ªç‚¹è¿æˆçº¿
   - [ ] Epoch 3å®Œæˆåï¼Œå›¾è¡¨æ›´æ–°ä¸º3ä¸ªç‚¹çš„æŠ˜çº¿
   - [ ] çº¢è‰²æ˜Ÿæ ‡æ ‡æ³¨åœ¨Rewardæœ€é«˜çš„ç‚¹ä¸Š

5. **æ£€æŸ¥æ–‡ä»¶**
   ```bash
   # Windows
   dir static\model_plots\training_curves_*.png
   
   # Linux/Mac
   ls static/model_plots/training_curves_*.png
   ```

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### å¯é€‰æ”¹è¿›
1. **å‡å°‘ç»˜å›¾é¢‘ç‡**ï¼šæ¯Nä¸ªepochæ›´æ–°ä¸€æ¬¡
   ```python
   if epoch % 2 == 0:  # æ¯2ä¸ªepochæ›´æ–°ä¸€æ¬¡
       # ç”Ÿæˆæ›²çº¿å›¾
   ```

2. **å›¾ç‰‡å‹ç¼©**ï¼šé™ä½DPIå‡å°æ–‡ä»¶ä½“ç§¯
   ```python
   plt.savefig(plot_path, dpi=100, bbox_inches="tight")  # ä»150é™åˆ°100
   ```

3. **æ·»åŠ ç§»åŠ¨å¹³å‡çº¿**ï¼šå¹³æ»‘æ›²çº¿
   ```python
   # è®¡ç®—5-epochç§»åŠ¨å¹³å‡
   if len(self.history_losses) >= 5:
       ma_losses = moving_average(self.history_losses, window=5)
       ax1.plot(epochs, ma_losses, 'r--', label='MA(5)')
   ```

## ğŸ“ é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šå‰ç«¯æ”¶ä¸åˆ°plotæ¶ˆæ¯
- æ£€æŸ¥SSEè¿æ¥æ˜¯å¦æ­£å¸¸
- æŸ¥çœ‹Pythonæ§åˆ¶å°æ˜¯å¦æœ‰å¼‚å¸¸
- ç¡®è®¤ `static/model_plots/` ç›®å½•å­˜åœ¨

### é—®é¢˜2ï¼šå›¾ç‰‡ä¸æ›´æ–°
- URLæ˜¯å¦æ·»åŠ äº†æ—¶é—´æˆ³å‚æ•°
- æµè§ˆå™¨æ˜¯å¦æ¸…é™¤äº†ç¼“å­˜
- æ–‡ä»¶æ˜¯å¦çœŸçš„è¢«æ›´æ–°ï¼ˆæ£€æŸ¥æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼‰

### é—®é¢˜3ï¼šä¸­æ–‡æ˜¾ç¤ºä¹±ç 
- å®‰è£…ä¸­æ–‡å­—ä½“ï¼šSimHei æˆ– Microsoft YaHei
- Windowsé€šå¸¸è‡ªå¸¦ï¼ŒLinuxå¯èƒ½éœ€è¦å®‰è£…
- ä¿®æ”¹å­—ä½“é…ç½®ï¼š`matplotlib.rcParams['font.sans-serif']`

## âœ¨ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®æ”¹ï¼Œå®ç°äº†ï¼š
1. âœ… æ¯ä¸ªepochç»“æŸåè‡ªåŠ¨ç”Ÿæˆè®­ç»ƒæ›²çº¿
2. âœ… Losså’ŒRewardåˆ†åˆ«æ˜¾ç¤ºåœ¨ä¸¤ä¸ªå­å›¾ä¸­
3. âœ… é€šè¿‡SSEå®æ—¶æ¨é€åˆ°å‰ç«¯
4. âœ… æ ‡æ³¨æœ€ä½³Rewardçš„ä½ç½®
5. âœ… å®Œæ•´çš„å®¹é”™å¤„ç†
6. âœ… ä¸å½±å“ç°æœ‰è®­ç»ƒæµç¨‹

ç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å®æ—¶çœ‹åˆ°æ¨¡å‹çš„å­¦ä¹ æ›²çº¿ï¼Œæ›´ç›´è§‚åœ°ç›‘æ§è®­ç»ƒæ•ˆæœï¼

