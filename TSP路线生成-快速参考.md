# TSPè·¯çº¿ç”Ÿæˆ - å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

**å¦‚ä½•åœ¨TSPé—®é¢˜ä¸‹åŠ¨æ€å±•ç¤ºè®­ç»ƒåçš„è·¯çº¿ï¼Ÿ**

## âš¡ å¿«é€Ÿå›ç­”

è®­ç»ƒåçš„TSPè·¯çº¿é€šè¿‡ä»¥ä¸‹3ä¸ªæ­¥éª¤ç”Ÿæˆï¼š

1. **ç­–ç•¥ç½‘ç»œå‰å‘æ¨ç†**ï¼šå°†åŸå¸‚åæ ‡è¾“å…¥è®­ç»ƒå¥½çš„æ³¨æ„åŠ›æ¨¡å‹
2. **è´ªå¿ƒè§£ç **ï¼šé€æ­¥é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„åŸå¸‚æ„å»ºè·¯çº¿
3. **å¯è§†åŒ–å¯¹æ¯”**ï¼šç”¨matplotlibç»˜åˆ¶éšæœºç­–ç•¥vsè®­ç»ƒåç­–ç•¥çš„è·¯å¾„å›¾

---

## ğŸ“ ä»£ç ä½ç½®

**æ–‡ä»¶ï¼š** `app.py`  
**å‡½æ•°ï¼š** `real_rl4co_training()`  
**è¡Œæ•°ï¼š** 354-381è¡Œ

```python
# æ ¸å¿ƒä»£ç ç‰‡æ®µ
policy = model.policy.to(device)
td_init = env.reset(batch_size=[3]).to(device)  # ç”Ÿæˆ3ä¸ªæµ‹è¯•é—®é¢˜

# éšæœºç­–ç•¥ï¼ˆå¯¹æ¯”åŸºå‡†ï¼‰
out_untrained = policy(td_init.clone(), decode_type="sampling", ...)
actions_untrained = out_untrained['actions']  # éšæœºè·¯çº¿

# è®­ç»ƒåç­–ç•¥ï¼ˆä¼˜åŒ–è·¯çº¿ï¼‰
out_trained = policy(td_init.clone(), decode_type="greedy", ...)
actions_trained = out_trained['actions']  # ä¼˜åŒ–è·¯çº¿

# å¯è§†åŒ–
for i, td in enumerate(td_init):
    fig, axs = plt.subplots(1, 2, figsize=(12, 5))
    env.render(td, actions_untrained[i], ax=axs[0])  # å·¦å›¾ï¼šéšæœº
    env.render(td, actions_trained[i], ax=axs[1])    # å³å›¾ï¼šè®­ç»ƒå
    plt.savefig(f"comparison_{session_id[:8]}_{i+1}.png")
```

---

## ğŸ” å…³é”®æ¦‚å¿µ

### 1. è§£ç æ–¹å¼å¯¹æ¯”

| è§£ç ç±»å‹ | ç­–ç•¥ | ç”¨é€” | è´¨é‡ |
|---------|------|------|------|
| **Sampling** | æŒ‰æ¦‚ç‡éšæœºé‡‡æ · | åŸºå‡†å¯¹æ¯” | å·® |
| **Greedy** | é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„åŠ¨ä½œ | å¿«é€Ÿæ¨ç† | å¥½ |

### 2. è·¯çº¿æ„å»ºè¿‡ç¨‹

```
èµ·ç‚¹ï¼ˆåŸå¸‚0ï¼‰
  â†“
ç­–ç•¥ç½‘ç»œè¾“å‡ºæ¦‚ç‡ [0.05, 0.78, 0.02, ...]
  â†“
Greedyé€‰æ‹©åŸå¸‚1ï¼ˆæ¦‚ç‡0.78æœ€å¤§ï¼‰
  â†“
æ›´æ–°çŠ¶æ€ï¼Œé‡å¤49æ¬¡
  â†“
å®Œæ•´è·¯çº¿ [0, 1, 7, 12, ...]
```

### 3. æ•°æ®æµ

```
åŸå¸‚åæ ‡ [50, 2]
  â†“
Encoderï¼ˆç¼–ç å™¨ï¼‰â†’ é«˜ç»´ç‰¹å¾ [50, 128]
  â†“
Attentionï¼ˆæ³¨æ„åŠ›ï¼‰â†’ å…³ç³»å»ºæ¨¡ [50, 128]
  â†“
Decoderï¼ˆè§£ç å™¨ï¼‰â†’ é€‰æ‹©æ¦‚ç‡ [50]
  â†“
Greedy/Sampling â†’ é€‰ä¸­1ä¸ªåŸå¸‚
```

---

## ğŸ“Š è¾“å…¥è¾“å‡º

### è¾“å…¥
```python
td_init = {
    'locs': Tensor[3, 50, 2],  # 3ä¸ªé—®é¢˜ï¼Œæ¯ä¸ª50ä¸ªåŸå¸‚ï¼Œ2Dåæ ‡
    'action_mask': Tensor[3, 50],  # å¯è®¿é—®æ©ç 
}
```

### è¾“å‡º
```python
{
    'actions': Tensor[3, 50],  # 3æ¡è·¯çº¿ï¼Œæ¯æ¡50ä¸ªåŸå¸‚ID
    'reward': Tensor[3],       # 3ä¸ªè·¯çº¿æˆæœ¬ï¼ˆè´Ÿå€¼ï¼‰
}

# ç¤ºä¾‹
actions[0] = [0, 3, 7, 12, 19, 25, ...]  # è®¿é—®é¡ºåº
reward[0] = -8.2341  # æ€»è·ç¦»çš„è´Ÿå€¼
```

### å¯è§†åŒ–æ–‡ä»¶
```
static/model_plots/
  â”œâ”€â”€ comparison_6c61a541_1.png  # é—®é¢˜1å¯¹æ¯”å›¾
  â”œâ”€â”€ comparison_6c61a541_2.png  # é—®é¢˜2å¯¹æ¯”å›¾
  â””â”€â”€ comparison_6c61a541_3.png  # é—®é¢˜3å¯¹æ¯”å›¾
```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆè®­ç»ƒåæ›´å¥½ï¼Ÿ

### REINFORCEå­¦ä¹ æœºåˆ¶

```
å¥½è·¯çº¿ï¼ˆçŸ­è·ç¦»ï¼‰â†’ é«˜Reward â†’ â†‘å¢åŠ è¯¥ç­–ç•¥æ¦‚ç‡
å·®è·¯çº¿ï¼ˆé•¿è·ç¦»ï¼‰â†’ ä½Reward â†’ â†“é™ä½è¯¥ç­–ç•¥æ¦‚ç‡
```

### å­¦åˆ°çš„å¯å‘å¼è§„åˆ™

- âœ… **è¿‘é‚»ä¼˜å…ˆ**ï¼šä¼˜å…ˆè®¿é—®è·ç¦»è¿‘çš„åŸå¸‚
- âœ… **é¿å…äº¤å‰**ï¼šç”Ÿæˆä¸äº¤å‰çš„è·¯å¾„
- âœ… **è¯†åˆ«èšç±»**ï¼šè¯†åˆ«åŸå¸‚çš„ç©ºé—´èšç±»ç»“æ„
- âœ… **å…¨å±€ä¼˜åŒ–**ï¼šè€ƒè™‘å…¨å±€è·¯å¾„è€Œéå±€éƒ¨æœ€ä¼˜

---

## ğŸ¨ å¯è§†åŒ–æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Random | Cost = 12.58  â”‚  Trained | Cost = 8.23  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â—â”€â”€â”€â”€â”€â—         â”‚        â—â”€â”€â”€â—            â”‚
â”‚         â”‚  â•±  â”‚         â”‚        â”‚   â”‚            â”‚
â”‚         â— â—  â—          â”‚        â—â”€â”€â”€â—            â”‚
â”‚       è·¯å¾„äº¤å‰           â”‚      è·¯å¾„é¡ºç•…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·¦å›¾**ï¼šSamplingè§£ç ï¼Œè·¯å¾„æ‚ä¹±ï¼Œæˆæœ¬é«˜  
**å³å›¾**ï¼šGreedyè§£ç ï¼Œè·¯å¾„æ¸…æ™°ï¼Œæˆæœ¬ä½

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æµ‹è¯•å®ä¾‹æ•°é‡
```python
td_init = env.reset(batch_size=[5])  # æ”¹ä¸º5ä¸ªé—®é¢˜
```

### ä¿®æ”¹åŸå¸‚æ•°é‡
```python
env = TSPEnv(generator_params={'num_loc': 100})  # æ”¹ä¸º100ä¸ªåŸå¸‚
```

### ä½¿ç”¨Beam Searchï¼ˆæ›´ä¼˜è´¨é‡ï¼‰
```python
out_trained = policy(td_init, decode_type="beam_search", beam_width=10)
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å…¸å‹æ”¹è¿›å¹…åº¦

| é—®é¢˜è§„æ¨¡ | éšæœºç­–ç•¥ | è®­ç»ƒå | æ”¹è¿› |
|---------|---------|--------|------|
| 50åŸå¸‚ | 12.58 | 8.23 | 34.6% |
| 100åŸå¸‚ | 21.45 | 13.67 | 36.3% |

### æ¨ç†é€Ÿåº¦

- å•æ¡è·¯çº¿ç”Ÿæˆï¼š< 10ms (GPU)
- æ‰¹é‡3æ¡è·¯çº¿ï¼š< 15ms (GPU)
- é€‚åˆå®æ—¶åº”ç”¨

---

## ğŸš€ å®Œæ•´æµç¨‹æ—¶é—´çº¿

```
t=0s     è®­ç»ƒå®Œæˆ
t=0.1s   å‡†å¤‡ç­–ç•¥ç½‘ç»œå’Œæµ‹è¯•æ•°æ®
t=0.2s   ç”Ÿæˆéšæœºç­–ç•¥è·¯çº¿ï¼ˆ3æ¡ï¼‰
t=0.3s   ç”Ÿæˆè®­ç»ƒåç­–ç•¥è·¯çº¿ï¼ˆ3æ¡ï¼‰
t=0.5s   è®¡ç®—Rewardå’Œæˆæœ¬
t=1.0s   ç”Ÿæˆmatplotlibå¯è§†åŒ–ï¼ˆ3å¼ å›¾ï¼‰
t=1.5s   ä¿å­˜PNGæ–‡ä»¶åˆ°ç£ç›˜
t=1.6s   è¿”å›ç»“æœç»™å‰ç«¯
t=2.0s   å‰ç«¯å±•ç¤ºå›¾ç‰‡
```

**æ€»è€—æ—¶ï¼šçº¦2ç§’** âš¡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†åŸç†**ï¼š`TSPè·¯çº¿ç”ŸæˆåŸç†è¯´æ˜.md`
- **æ•°æ®æµå›¾è§£**ï¼š`TSPè·¯çº¿ç”Ÿæˆæ•°æ®æµå›¾è§£.txt`
- **ä»£ç æ¼”ç¤º**ï¼š`TSPè·¯çº¿ç”Ÿæˆæµç¨‹å›¾.py`
- **æºä»£ç **ï¼š`app.py` (354-381è¡Œ)

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç”Ÿæˆ3å¼ å›¾ï¼Ÿ
**A:** å±•ç¤ºæ¨¡å‹åœ¨ä¸åŒTSPå®ä¾‹ä¸Šçš„æ³›åŒ–èƒ½åŠ›ï¼Œé¿å…å¶ç„¶æ€§ã€‚

### Q2: Samplingå’ŒGreedyçš„å®é™…å·®å¼‚æœ‰å¤šå¤§ï¼Ÿ
**A:** é€šå¸¸Greedyæ¯”Samplingå¥½30-40%ï¼Œå…·ä½“å–å†³äºé—®é¢˜å¤æ‚åº¦ã€‚

### Q3: å¯ä»¥å®æ—¶è§‚çœ‹è·¯çº¿ç”Ÿæˆè¿‡ç¨‹å—ï¼Ÿ
**A:** å½“å‰æ˜¯è®­ç»ƒå®Œæˆåæ‰¹é‡ç”Ÿæˆã€‚å¦‚éœ€åŠ¨æ€å±•ç¤ºï¼Œå¯åœ¨è§£ç æ—¶é€æ­¥æ¨é€ä¸­é—´çŠ¶æ€ã€‚

### Q4: è®­ç»ƒåçš„ç­–ç•¥æ˜¯å¦æ¯æ¬¡ç”Ÿæˆç›¸åŒè·¯çº¿ï¼Ÿ
**A:** Greedyè§£ç æ˜¯ç¡®å®šæ€§çš„ï¼Œç›¸åŒè¾“å…¥æ€»æ˜¯äº§ç”Ÿç›¸åŒè·¯çº¿ã€‚Samplingæ˜¯éšæœºçš„ã€‚

### Q5: å¦‚ä½•æé«˜è·¯çº¿è´¨é‡ï¼Ÿ
**A:** 
- å¢åŠ è®­ç»ƒè½®æ•°ï¼ˆæ›´å¤šepochsï¼‰
- ä½¿ç”¨Beam Searchè§£ç 
- å¢åŠ æ¨¡å‹å®¹é‡ï¼ˆæ›´å¤šå±‚/æ›´å¤§åµŒå…¥ç»´åº¦ï¼‰

---

## ğŸ“ æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **RL4CO**: å¼ºåŒ–å­¦ä¹ ç»„åˆä¼˜åŒ–åº“
- **PyTorch**: æ·±åº¦å­¦ä¹ æ¡†æ¶
- **Lightning**: è®­ç»ƒæµç¨‹ç®¡ç†
- **Matplotlib**: å¯è§†åŒ–å·¥å…·
- **Flask**: Webåç«¯
- **SSE**: å‰ç«¯å®æ—¶æ›´æ–°

---

**æ›´æ–°æ—¶é—´ï¼š** 2025å¹´  
**å¹³å°ï¼š** RL4CO å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–å¹³å°  
**å•ä½ï¼š** å±±è¥¿å¤§å­¦ è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯å­¦é™¢

