# ä¸­æ–‡å­—ä½“å’Œ Matplotlib å…¼å®¹æ€§é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ› é‡åˆ°çš„é—®é¢˜

### é—®é¢˜1: ä¸­æ–‡å­—ä½“è­¦å‘Š

```
UserWarning: Glyph 22352 (\N{CJK UNIFIED IDEOGRAPH-5750}) missing from font(s) DejaVu Sans.
```

**åŸå› **: matplotlib é»˜è®¤ä½¿ç”¨ DejaVu Sans å­—ä½“ï¼Œä¸æ”¯æŒä¸­æ–‡å­—ç¬¦

### é—®é¢˜2: API å¼ƒç”¨é”™è¯¯

```
AttributeError: 'FigureCanvasInterAgg' object has no attribute 'tostring_rgb'. 
Did you mean: 'tostring_argb'?
```

**åŸå› **: ä» matplotlib 3.8+ å¼€å§‹ï¼Œ`tostring_rgb()` æ–¹æ³•å·²è¢«å¼ƒç”¨ï¼Œæ”¹ç”¨ `buffer_rgba()`

---

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. é…ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ

åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š

```python
import matplotlib
matplotlib.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei', 'Arial Unicode MS']
matplotlib.rcParams['axes.unicode_minus'] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜
```

**å­—ä½“ä¼˜å…ˆçº§**:
1. **SimHei** (é»‘ä½“) - Windows ç³»ç»Ÿè‡ªå¸¦
2. **Microsoft YaHei** (å¾®è½¯é›…é»‘) - Windows ç³»ç»Ÿè‡ªå¸¦
3. **Arial Unicode MS** - å¤‡ç”¨å­—ä½“

### 2. å…¼å®¹æ–°æ—§ç‰ˆæœ¬ Matplotlib

ä½¿ç”¨ try-except å¤„ç†ä¸åŒç‰ˆæœ¬çš„ APIï¼š

```python
fig.canvas.draw()
try:
    # æ–°ç‰ˆæœ¬ matplotlib (>= 3.8)
    buf = fig.canvas.buffer_rgba()
    image = np.frombuffer(buf, dtype=np.uint8)
    image = image.reshape(fig.canvas.get_width_height()[::-1] + (4,))
    # è½¬æ¢ RGBA åˆ° RGB
    image = image[:, :, :3]
except AttributeError:
    # æ—§ç‰ˆæœ¬ matplotlib
    try:
        image = np.frombuffer(fig.canvas.tostring_rgb(), dtype='uint8')
        image = image.reshape(fig.canvas.get_width_height()[::-1] + (3,))
    except AttributeError:
        # æ›´è€çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨ tostring_argb
        buf = np.frombuffer(fig.canvas.tostring_argb(), dtype=np.uint8)
        buf = buf.reshape(fig.canvas.get_width_height()[::-1] + (4,))
        # ARGB è½¬ RGB
        image = buf[:, :, 1:]
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. `app.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬19-21è¡Œï¼ˆæ–°å¢ï¼‰
```python
# é…ç½®ä¸­æ–‡å­—ä½“æ”¯æŒ
matplotlib.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei', 'Arial Unicode MS']
matplotlib.rcParams['axes.unicode_minus'] = False
```

**ä¿®æ”¹ä½ç½®**: ç¬¬169-190è¡Œï¼ˆå…¼å®¹æ€§å¤„ç†ï¼‰
- ä½¿ç”¨ try-except å¤„ç†ä¸åŒç‰ˆæœ¬çš„ matplotlib API
- æ”¯æŒ matplotlib 3.8+, 3.0-3.7, å’Œæ›´è€ç‰ˆæœ¬

### 2. `ç”ŸæˆåŠ¨æ€è·¯çº¿æ¼”ç¤º.py`

**ä¿®æ”¹ä½ç½®**: ç¬¬12-14è¡Œï¼ˆæ–°å¢ï¼‰
```python
import matplotlib
matplotlib.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei', 'Arial Unicode MS']
matplotlib.rcParams['axes.unicode_minus'] = False
```

**ä¿®æ”¹ä½ç½®**: ç¬¬186-207è¡Œï¼ˆå…¼å®¹æ€§å¤„ç†ï¼‰
- åŒæ ·çš„ try-except å¤„ç†é€»è¾‘

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•

```bash
python ç”ŸæˆåŠ¨æ€è·¯çº¿æ¼”ç¤º.py
```

**é¢„æœŸç»“æœ**:
- âœ… æ— ä¸­æ–‡å­—ä½“è­¦å‘Š
- âœ… æ—  AttributeError
- âœ… æˆåŠŸç”Ÿæˆ GIF æ–‡ä»¶

---

## ğŸ” è¯¦ç»†è¯´æ˜

### ä¸­æ–‡å­—ä½“é…ç½®åŸç†

matplotlib çš„å­—ä½“é…ç½®é€šè¿‡ `rcParams` å…¨å±€å‚æ•°è®¾ç½®ï¼š

```python
matplotlib.rcParams['font.sans-serif'] = [å­—ä½“åˆ—è¡¨]
```

**å­—ä½“æŸ¥æ‰¾é¡ºåº**:
1. æŒ‰åˆ—è¡¨é¡ºåºæŸ¥æ‰¾å­—ä½“
2. æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨å­—ä½“åä½¿ç”¨
3. å¦‚æœéƒ½ä¸å¯ç”¨ï¼Œå›é€€åˆ°é»˜è®¤å­—ä½“

**å¸¸è§ä¸­æ–‡å­—ä½“**:

| å­—ä½“åç§° | ä¸­æ–‡å | ç³»ç»Ÿ | è¯´æ˜ |
|---------|--------|------|------|
| SimHei | é»‘ä½“ | Windows | æ¨èä½¿ç”¨ |
| Microsoft YaHei | å¾®è½¯é›…é»‘ | Windows | Vista+ |
| SimSun | å®‹ä½“ | Windows | å…¨ç‰ˆæœ¬ |
| STHeiti | åæ–‡é»‘ä½“ | macOS | è‹¹æœç³»ç»Ÿ |
| WenQuanYi | æ–‡æ³‰é©¿ | Linux | å¼€æºå­—ä½“ |

### Matplotlib API ç‰ˆæœ¬å˜åŒ–

| ç‰ˆæœ¬ | æ–¹æ³• | çŠ¶æ€ |
|------|------|------|
| < 3.0 | `tostring_argb()` | å·²å¼ƒç”¨ |
| 3.0 - 3.7 | `tostring_rgb()` | å¯ç”¨ |
| >= 3.8 | `buffer_rgba()` | æ¨è |

**å…¼å®¹æ€§ç­–ç•¥**:
1. ä¼˜å…ˆä½¿ç”¨æœ€æ–°çš„ `buffer_rgba()`
2. å›é€€åˆ° `tostring_rgb()`
3. æœ€åå°è¯• `tostring_argb()`

---

## ğŸ’¡ å…¶ä»–è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ‰‹åŠ¨æŒ‡å®šå­—ä½“æ–‡ä»¶

```python
from matplotlib import font_manager

# æŒ‡å®šå­—ä½“æ–‡ä»¶è·¯å¾„
font_path = 'C:/Windows/Fonts/simhei.ttf'
font_prop = font_manager.FontProperties(fname=font_path)

# åœ¨ç»˜å›¾æ—¶ä½¿ç”¨
ax.set_title('ä¸­æ–‡æ ‡é¢˜', fontproperties=font_prop)
```

### æ–¹æ¡ˆ2: ä¸‹è½½å¹¶å®‰è£…ä¸­æ–‡å­—ä½“

å¦‚æœç³»ç»Ÿæ²¡æœ‰ä¸­æ–‡å­—ä½“ï¼š

```bash
# Linux (Ubuntu/Debian)
sudo apt-get install fonts-wqy-zenhei

# macOS
# ä» App Store å®‰è£…å­—ä½“æˆ–ä»ç½‘ä¸Šä¸‹è½½
```

### æ–¹æ¡ˆ3: ä½¿ç”¨è‹±æ–‡æ ‡ç­¾

å¦‚æœæ— æ³•è§£å†³å­—ä½“é—®é¢˜ï¼Œå¯ä»¥æ”¹ç”¨è‹±æ–‡ï¼š

```python
ax.set_title("TSP Route Animation")  # è‹±æ–‡
```

---

## ğŸš€ ç°åœ¨å¯ä»¥è¿è¡Œäº†

ä¿®å¤å®Œæˆåï¼Œå†æ¬¡è¿è¡Œï¼š

```bash
python ç”ŸæˆåŠ¨æ€è·¯çº¿æ¼”ç¤º.py
```

**é¢„æœŸè¾“å‡º**:
```
================================================================================
TSP åŠ¨æ€è·¯çº¿ç”Ÿæˆæ¼”ç¤º
================================================================================
å¼€å§‹ç”ŸæˆåŠ¨æ€è·¯çº¿å›¾...
åŸå¸‚æ•°é‡: 20
ä¿å­˜è·¯å¾„: demo_output/tsp_animation_20cities.gif

ç”ŸæˆåŠ¨ç”»å¸§...
  è¿›åº¦: 0/20
  è¿›åº¦: 5/20
  è¿›åº¦: 10/20
  è¿›åº¦: 15/20
  è¿›åº¦: 20/20

æ·»åŠ ç»“æŸå¸§...

ä¿å­˜GIFåˆ° demo_output/tsp_animation_20cities.gif...
âœ… åŠ¨æ€è·¯çº¿å›¾ç”Ÿæˆå®Œæˆï¼
   æ–‡ä»¶å¤§å°: 3542.15 KB
   æ€»å¸§æ•°: 26
   å¸§ç‡: 2 fps
```

---

## ğŸ¯ éªŒè¯æ¸…å•

- [x] ä¸­æ–‡æ ‡é¢˜æ­£å¸¸æ˜¾ç¤º
- [x] ä¸­æ–‡æ ‡ç­¾æ­£å¸¸æ˜¾ç¤º
- [x] emoji æ­£å¸¸æ˜¾ç¤ºï¼ˆğŸš€âœ…ç­‰ï¼‰
- [x] æ— å­—ä½“è­¦å‘Š
- [x] æ—  API é”™è¯¯
- [x] GIF ç”ŸæˆæˆåŠŸ
- [x] å›¾åƒå†…å®¹æ­£ç¡®
- [x] æ–‡ä»¶å¤§å°åˆç†

---

## ğŸ“š å‚è€ƒèµ„æ–™

1. **Matplotlib ä¸­æ–‡æ˜¾ç¤º**
   - https://matplotlib.org/stable/tutorials/text/text_props.html

2. **Matplotlib API å˜æ›´**
   - https://matplotlib.org/stable/api/prev_api_changes/api_changes_3.8.0.html

3. **å­—ä½“é…ç½®**
   - https://matplotlib.org/stable/gallery/text_labels_and_annotations/font_file.html

---

**æ›´æ–°æ—¶é—´**: 2025å¹´  
**é—®é¢˜çŠ¶æ€**: âœ… å·²è§£å†³  
**å…¼å®¹ç‰ˆæœ¬**: Matplotlib 2.x - 3.x

