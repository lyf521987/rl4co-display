# 数据库清理 - 完整指南

> 详细说明如何清理MySQL数据库中的用户数据，包括快速步骤和完整流程。

---

## 📋 目录

1. [快速步骤](#快速步骤)
2. [完整流程](#完整流程)
3. [SQL命令说明](#sql命令说明)
4. [故障排查](#故障排查)

---

## 快速步骤

### PyCharm数据库清理

#### 1. 打开数据库连接
```
PyCharm → 右侧 Database 面板 → 选择你的MySQL数据库
```

#### 2. 打开SQL控制台
```
右键数据库 → 点击 "Console" → "Open SQL Console"
```

#### 3. 执行清理命令
```sql
-- 查看现有用户
SELECT * FROM flaskdemo_user.users;

-- 删除所有用户数据
DELETE FROM flaskdemo_user.users;

-- 确认删除
SELECT COUNT(*) FROM flaskdemo_user.users;
-- 应该返回 0
```

#### 4. 提交更改
```
Ctrl+Enter (Windows) 或 Cmd+Enter (Mac)
```

---

## 完整流程

### 方法1: 使用PyCharm

#### 步骤1: 连接数据库

1. 打开PyCharm
2. 点击右侧 `Database` 面板（如果没有，通过 `View → Tool Windows → Database` 打开）
3. 点击 `+` 号 → `Data Source` → `MySQL`
4. 填写连接信息：
   ```
   Host: localhost
   Port: 3306
   Database: flaskdemo_user
   User: root
   Password: [你的密码]
   ```
5. 点击 `Test Connection` 确认连接成功
6. 点击 `OK` 保存连接

#### 步骤2: 打开SQL控制台

1. 在Database面板中找到你的连接
2. 展开 `flaskdemo_user` 数据库
3. 右键数据库名称
4. 选择 `Console → Open SQL Console`

#### 步骤3: 执行清理SQL

在SQL控制台中输入并执行：

```sql
-- 1. 查看当前用户（可选）
SELECT * FROM flaskdemo_user.users;

-- 2. 删除所有用户
DELETE FROM flaskdemo_user.users;

-- 3. 确认删除成功
SELECT COUNT(*) FROM flaskdemo_user.users;
-- 应该返回: 0
```

执行方式：
- 选中要执行的SQL语句
- 按 `Ctrl+Enter` (Windows) 或 `Cmd+Enter` (Mac)
- 或点击工具栏的绿色"运行"按钮

#### 步骤4: 提交更改

PyCharm默认会自动提交，如果需要手动提交：
```sql
COMMIT;
```

### 方法2: 使用MySQL命令行

#### 步骤1: 连接数据库

```bash
# Windows
mysql -u root -p

# 输入密码后
USE flaskdemo_user;
```

#### 步骤2: 执行清理命令

```sql
-- 查看现有用户
SELECT * FROM users;

-- 删除所有用户
DELETE FROM users;

-- 确认删除
SELECT COUNT(*) FROM users;
```

#### 步骤3: 退出

```sql
EXIT;
```

### 方法3: 使用Navicat/DBeaver等工具

#### 步骤1: 连接数据库

1. 新建连接
2. 填写连接信息（同PyCharm）
3. 测试并连接

#### 步骤2: 执行SQL

1. 打开查询窗口（Query Window）
2. 输入清理SQL
3. 执行（F5或点击运行按钮）

---

## SQL命令说明

### 基本命令

#### 查看所有用户
```sql
SELECT * FROM flaskdemo_user.users;
```
**说明**: 查看users表中的所有记录

**返回示例**:
```
+----+----------+------------------+---------------------+
| id | username | password         | create_time         |
+----+----------+------------------+---------------------+
|  1 | admin    | hashed_password1 | 2024-01-01 10:00:00 |
|  2 | user1    | hashed_password2 | 2024-01-02 11:00:00 |
+----+----------+------------------+---------------------+
```

#### 查看用户数量
```sql
SELECT COUNT(*) FROM flaskdemo_user.users;
```
**说明**: 返回users表中的记录总数

#### 删除所有用户
```sql
DELETE FROM flaskdemo_user.users;
```
**警告**: ⚠️ 此操作会永久删除所有用户数据，不可恢复！

#### 删除特定用户
```sql
DELETE FROM flaskdemo_user.users WHERE username = 'user1';
```
**说明**: 只删除用户名为'user1'的用户

#### 查看表结构
```sql
DESCRIBE flaskdemo_user.users;
```
**说明**: 显示users表的结构（列名、类型等）

### 高级操作

#### 清空表并重置自增ID
```sql
TRUNCATE TABLE flaskdemo_user.users;
```
**说明**: 
- 删除所有数据
- 重置AUTO_INCREMENT
- 比DELETE更快

#### 备份用户数据
```sql
CREATE TABLE users_backup AS SELECT * FROM users;
```
**说明**: 在删除前创建备份

#### 恢复备份数据
```sql
INSERT INTO users SELECT * FROM users_backup;
```
**说明**: 从备份表恢复数据

---

## 故障排查

### 问题1: 无法连接数据库

**错误信息**:
```
Access denied for user 'root'@'localhost'
```

**解决方案**:
1. 检查密码是否正确
2. 检查用户权限：
```sql
SHOW GRANTS FOR 'root'@'localhost';
```
3. 重置密码（如果忘记）

### 问题2: 表不存在

**错误信息**:
```
Table 'flaskdemo_user.users' doesn't exist
```

**解决方案**:
1. 检查数据库名是否正确
2. 检查表名是否正确
3. 列出所有表：
```sql
SHOW TABLES FROM flaskdemo_user;
```

### 问题3: 权限不足

**错误信息**:
```
Access denied; you need (at least one of) the DELETE privilege(s)
```

**解决方案**:
```sql
-- 以root用户执行
GRANT DELETE ON flaskdemo_user.* TO 'your_user'@'localhost';
FLUSH PRIVILEGES;
```

### 问题4: 无法删除数据

**可能原因**:
- 表被锁定
- 外键约束

**解决方案**:
```sql
-- 查看锁定的表
SHOW OPEN TABLES WHERE In_use > 0;

-- 暂时禁用外键检查
SET FOREIGN_KEY_CHECKS = 0;
DELETE FROM flaskdemo_user.users;
SET FOREIGN_KEY_CHECKS = 1;
```

### 问题5: PyCharm无法执行SQL

**解决方案**:
1. 确认已选中要执行的SQL语句
2. 使用正确的快捷键（Ctrl+Enter）
3. 检查Database面板中的连接状态
4. 重新连接数据库

---

## 安全建议

### ⚠️ 删除前必读

1. **备份数据**: 删除前先备份
   ```sql
   CREATE TABLE users_backup AS SELECT * FROM users;
   ```

2. **确认环境**: 确保不是在生产环境操作
   ```sql
   SELECT DATABASE();  -- 确认当前数据库
   ```

3. **使用事务**: 可以回滚的删除
   ```sql
   START TRANSACTION;
   DELETE FROM users;
   -- 如果确认无误
   COMMIT;
   -- 如果需要撤销
   -- ROLLBACK;
   ```

4. **限制删除范围**: 先查询再删除
   ```sql
   -- 先查询
   SELECT * FROM users WHERE username = 'test';
   -- 确认后删除
   DELETE FROM users WHERE username = 'test';
   ```

### 🔒 权限管理

```sql
-- 创建只有读取权限的用户
CREATE USER 'readonly'@'localhost' IDENTIFIED BY 'password';
GRANT SELECT ON flaskdemo_user.* TO 'readonly'@'localhost';

-- 创建有完全权限的用户
CREATE USER 'admin'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON flaskdemo_user.* TO 'admin'@'localhost';
```

---

## 快速参考表

### 常用命令速查

| 操作 | SQL命令 |
|------|---------|
| **查看所有用户** | `SELECT * FROM users;` |
| **查看用户数量** | `SELECT COUNT(*) FROM users;` |
| **删除所有用户** | `DELETE FROM users;` |
| **删除特定用户** | `DELETE FROM users WHERE id = 1;` |
| **清空并重置** | `TRUNCATE TABLE users;` |
| **备份表** | `CREATE TABLE users_backup AS SELECT * FROM users;` |
| **恢复备份** | `INSERT INTO users SELECT * FROM users_backup;` |

### PyCharm快捷键

| 操作 | 快捷键 (Windows) | 快捷键 (Mac) |
|------|-----------------|--------------|
| **执行SQL** | Ctrl+Enter | Cmd+Enter |
| **执行选中** | Ctrl+Enter | Cmd+Enter |
| **执行全部** | Ctrl+Shift+Enter | Cmd+Shift+Enter |
| **格式化SQL** | Ctrl+Alt+L | Cmd+Option+L |
| **注释/取消注释** | Ctrl+/ | Cmd+/ |

---

## 相关文档

- [文件管理功能完整指南](文件管理功能完整指南.md)
- [模型知识库功能完整指南](模型知识库功能完整指南.md)

---

## 联系支持

如有问题，请联系：
- 📧 提交Issue到项目仓库
- 📖 查看完整文档
- 💬 联系开发团队

---

**文档版本**: v1.0.0  
**最后更新**: 2024年  
**平台**: RL4CO 强化学习优化平台  
**单位**: 山西大学 计算机科学与技术学院

